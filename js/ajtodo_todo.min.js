jQuery(document).ready(function(t){var o=!1,a="",n=ajax_todo_info.filter_project,e=t(todo_option_html),i="",d=[],s=[],l=[],r=[];t.notifyDefaults({delay:ajax_todo_info.noti_delay}),t("#sjtodo_search").keydown(function(o){13==o.keyCode&&(a=t(this).val().trim(),c())}),t("#btnQuickTodo").click(function(o){if(t("#ajtodo_title").val().length>0){var a="action=ajtodo_todo_ajax";a+="&nonce="+ajax_todo_info.nonce,a+="&type=createtodo",a+="&project_filter="+t("#ajtodo_projectid").val(),a+="&title="+t("#ajtodo_title").val(),_(a,"post",function(o){t("#ajtodo_title").val(""),console.log(1)},function(o){console.log(1),t.notify({message:res.msg},{type:"danger"})})}}),t("#ajtodo_todotitle").keydown(function(o){if(13==o.keyCode&&t(this).val().length>0){var a="action=ajtodo_todo_ajax";a+="&nonce="+ajax_todo_info.nonce,a+="&type=createtodo",a+="&project_filter="+n,a+="&title="+t(this).val(),_(a,"post",function(o){t("#ajtodo_todotitle").val(""),k(),u(o.todoid,function(o){"no"!=n&&""!=n&&o.data.projectid!=n||"no"==n&&null!=o.data.projectid||t("#todo_list").prepend(v(o.data))},function(t){console.log(t)})},function(t){console.log(t)})}});var _=function(o,a,n,e){t.ajax({url:ajax_todo_info.ajax_url,type:a,data:o,success:function(o){var a=t.parseJSON(o);a.result?(null!=a.msg&&t.notify({message:a.msg},{type:"success"}),n(a)):(t.notify({message:a.msg},{type:"danger"}),e(a.msg))}})},c=function(){!function(){t("#todo_list").empty();var o="<div class='text-center loadingbar'>";o+="<div class='spinner-border' role='status'>"+todo_lan.loadingtext+"</div> ",o+="</div>",t("#todo_list").append(o)}(),d=[],s=[],l=[];var o="action=ajtodo_todo_ajax";o+="&nonce="+ajax_todo_info.nonce,o+="&type=gettodolist",o+="&uid="+ajax_todo_info.uid,o+="&filter_project="+n,o+="&filter_user="+ajax_todo_info.user_filter,o+="&filter_status="+ajax_todo_info.status_filter,_(o+="&search="+a,"post",function(o){S(),t("#todo_list").empty(),todo_status=o.statuses,t.each(todo_status,function(t,o){"S"==o.statustype&&(s.push(o),l.push(o)),"I"==o.statustype&&(d.push(o),l.push(o),s.push(o)),"D"==o.statustype&&(d.push(o),l.push(o)),"S"==o.statustype&&o.id,"D"==o.statustype&&(i=o.id)}),o.todolist,t.each(o.todolist,function(o,a){t("#todo_list").append(v(a))})},function(t){console.log(t)})},u=function(t,o,a){var n="action=ajtodo_todo_ajax";n+="&nonce="+ajax_todo_info.nonce,n+="&type=getsingletodo",_(n+="&todo_id="+t,"post",function(t){o(t)},function(t){console.log(msg)})},f=function(a){u(a.todoid,function(e){k();var i=v(e.data);t("li.todo_list_item[var="+a.todoid+"]").replaceWith(i);var d=!1;"Y"==ajax_todo_info.auto_done_hidden&&("O"==ajax_todo_info.status_filter&&null!=e.data.donedated||"D"==ajax_todo_info.status_filter&&null==e.data.donedated||"no"!=n&&""!=n&&e.data.projectid!=n||"no"==n&&null!=e.data.projectid)&&(d=!0,t(i).fadeOut(1e3,function(){t(this).remove()})),!d&&o&&(p(i,e.data),o=!1)},function(o){t("li.todo_list_item[var="+a.todoid+"]").css("background","inherit")})},p=function(o,a){""==ajax_todo_info.status_filter&&("I"==a.status_type?t.each(t("li.todo_list_item"),function(n,e){if(t(e).attr("var")!=a.id)return t(e).before(o),!1}):"D"==a.status_type?t.each(t("li.todo_list_item"),function(n,e){if(t(e).attr("var")!=a.id&&"D"==t(e).attr("status"))return t(e).before(o),!1}):"S"==a.status_type&&t.each(t("li.todo_list_item"),function(n,e){if(t(e).attr("var")!=a.id&&"S"==t(e).attr("status"))return t(e).before(o),!1}))},j=function(t){console.log(t)},h=function(t){switch(t){case"S":return"primary";case"I":return"warning";case"D":return"success"}},v=function(a){var n,c;return n=""==ajax_todo_info.freeze?t("<li class='todo_list_item list-group-item-action list-group-item' status='"+a.status_type+"' var='"+a.id+"'></li>"):t("<li class='todo_list_item list-group-item-action list-group-item'></li>"),"S"==a.status_type?n.append("<i class='far fa-square'></i>"):"I"==a.status_type?n.append("<i class='far fa-caret-square-right'></i>"):n.append("<i class='far fa-check-square'></i>"),""==ajax_todo_info.freeze?n.append("<a href='#' class='todo_title "+(null!=a.donedated?"done":"")+"'>"+a.title+"</a>"):n.append("<span class='todo_title'>"+a.title+"</span>"),"D"==a.status_type&&n.append("<kbd class='clearfix float-right'>"+(c=a.donedated,moment(c)>moment().add(-3,"days")?moment(c).fromNow():moment(c).format("YYYY-MM-DD"))+"</kbd>"),""==ajax_todo_info.freeze&&(n.find("i").click(function(n){var e,d,s,l;o=!0,t("li.todo_list_item[var="+a.id+"]").css("background","#efefef"),t(this).hasClass("fa-square")&&("Y"==ajax_todo_info.direct_done?b(a.id,i,f,j):(e="statustypeid",d=ajax_todo_info.inprogress_status_id,s=a.id,l="action=ajtodo_todo_ajax",l+="&nonce="+ajax_todo_info.nonce,l+="&type=updatetodo",l+="&col="+e,l+="&val="+d,_(l+="&todo_id="+s,"post",f,j))),t(this).hasClass("fa-caret-square-right")?b(a.id,i,f,j):t(this).hasClass("fa-check-square")&&function(t,o,a,n){var e="action=ajtodo_todo_ajax";e+="&nonce="+ajax_todo_info.nonce,e+="&type=updatetodo",e+="&colval="+JSON.stringify(t),_(e+="&todo_id="+o,"post",f,j)}({statustypeid:ajax_todo_info.done_click,donedated:""},a.id)}),n.find("a.todo_tile").click(function(o){o.preventDefault(),t(this).parent().attr("var"),t("#todoview").css("width","50%")}),n.mouseenter(function(){t(this).find("kbd").hide(),t(e).attr("val",a.id),t(e).find(".ajtodo_del").removeClass("ajtodo_del_now").text(todo_lan.del),r.length>0&&(t(e).find("#todo_projects").empty(),t(e).find("#todo_projects").append(C(a))),t(e).find("#todo_status").empty(),"S"==a.status_type?t.each(d,function(o,a){var n="<button type='button' class='btn btn-"+h(a.statustype)+" btn_status' val='"+a.id+"'>"+a.title+"</button>";t(e).find("#todo_status").append(n)}):"I"==a.status_type?t.each(l,function(o,n){if(a.statustypeid!=n.id){var i="<button type='button' class='btn btn-"+h(n.statustype)+" btn_status' val='"+n.id+"'>"+n.title+"</button>";t(e).find("#todo_status").append(i)}}):"D"==a.status_type&&t.each(s,function(o,a){var n="<button type='button' class='btn btn-"+h(a.statustype)+" btn_status' val='"+a.id+"'>"+a.title+"</button>";t(e).find("#todo_status").append(n)}),t(this).append(t(e)),t(e).find(".btn").click(function(a){t(this).hasClass("ajtodo_del")&&(t(this).hasClass("ajtodo_del_now")?m(t(e).attr("val")):y(t(this),t(e).attr("val"))),t(this).hasClass("btn_status")&&(o=!0,b(t(e).attr("val"),t(this).attr("val"),f,j))})}),n.mouseleave(function(){t(this).find("kbd").show(),t(this).find(".todo_option_inline").remove()})),n},y=function(o,a){"Y"==ajax_todo_info.del_noconfirm?m(a):(t(o).text(todo_lan.delconfirm),t(o).addClass("ajtodo_del_now"))},m=function(o){var a="action=ajtodo_todo_ajax";a+="&nonce="+ajax_todo_info.nonce,a+="&type=deltodo",a+="&todo_id="+t(e).attr("val"),_(a,"post",function(o){t("#todo_list li[var="+o.todoid+"]").addClass("list-group-item-danger").attr("disabled",""),t("#todo_list li[var="+o.todoid+"]").fadeOut(1e3,function(){t(this).remove()})},function(t){err(t)})},b=function(t,o,a,n){var e="action=ajtodo_todo_ajax";e+="&nonce="+ajax_todo_info.nonce,e+="&type=updatestatus",e+="&todo_id="+t,_(e+="&status_id="+o,"post",function(t){k(),a(t)},function(t){n(t)})},x=function(){t.each(t("#ajtodo_todolist_user_filter button"),function(o){t(this).removeClass("btn-primary"),t(this).hasClass("btn-primary")||t(this).addClass("btn-secondary")}),t.each(t("#ajtodo_todolist_status_filter button"),function(o){t(this).removeClass("btn-primary").addClass("btn-secondary"),t(this).hasClass("btn-primary")||t(this).addClass("btn-secondary")}),t("#ajtodo_todolist_user_filter button[val='"+ajax_todo_info.user_filter+"']").removeClass("btn-secondary").addClass("btn-primary"),t("#ajtodo_todolist_status_filter button[val='"+ajax_todo_info.status_filter+"']").removeClass("btn-secondary").addClass("btn-primary")};t("#ajtodo_todolist_user_filter button").click(function(o){o.preventDefault(),ajax_todo_info.user_filter=t(this).attr("val"),x(),c()}),t("#ajtodo_todolist_status_filter button").click(function(o){o.preventDefault(),ajax_todo_info.status_filter=t(this).attr("val"),x(),c()});var g,k=function(){var o="action=ajtodo_todo_ajax";o+="&nonce="+ajax_todo_info.nonce,o+="&uid="+ajax_todo_info.uid,o+="&filter_project="+n,o+="&planid="+ajax_todo_info.planid,_(o+="&type=getprogress","post",function(o){if(o.totalcount>0){var a=100*o.opencount/o.totalcount,n=100*o.donecount/o.totalcount,e=100-a-n;t("#ajtodo_userprogress .bg-primary").css("width",a+"%"),t("#ajtodo_userprogress .bg-warning").css("width",e+"%"),t("#ajtodo_userprogress .bg-success").css("width",n+"%"),t(".todo_filter_inline .ajtodo_cnt_d").text(o.donecount),t(".todo_filter_inline .ajtodo_cnt_s").text(o.opencount),t(".todo_filter_inline .ajtodo_cnt_a").text(o.totalcount)}},function(t){})},w=function(o){var a="";return t.each(r,function(t,n){n.id==o&&(a=n.title)}),a},C=function(t){return"<button type='button' class='btn btn-info disabled' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>"+(t.projectid?w(t.projectid):todo_lan.noproject)+"</button>"},D=function(){t("#todo_filter_project").empty();var o="<button type='button' class='btn btn-danger dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>"+("no"==n?todo_lan.noproject:n?w(n):todo_lan.showall)+"</button>";o+="<div class='dropdown-menu'>",t.each(r,function(t,a){n!=a.id&&(o+="\t<a class='dropdown-item todo_project' href='' val='"+a.id+"'>"+a.title+"</a>")}),o+="\t<div class='dropdown-divider'></div>","no"!=n&&(o+="\t<a class='dropdown-item todo_project' href='' val='no'>"+todo_lan.noproject+"</a>"),""!=n&&(o+="\t<a class='dropdown-item todo_project' href='' val=''>"+todo_lan.showall+"</a>"),o+="</div>",t("#todo_filter_project").append(o),t("#todo_filter_project a").click(function(o){o.preventDefault(),n=t(this).attr("val"),D(),c(),k()})},S=function(){var o="[ajtodo uid="+ajax_todo_info.userid;""!=n&&(o+=" project="+n),""!=ajax_todo_info.status_filter&&(o+=" status="+ajax_todo_info.status_filter),""!=a&&(o+=" search="+a),o+="]",t("#ajtodo_todo_sc").html("<kbd>"+o+"</kbd>")};x(),k(),g="action=ajtodo_todo_ajax",g+="&nonce="+ajax_todo_info.nonce,_(g+="&type=getprojects","post",function(t){r=t.projects,D()},function(t){}),c(),moment.locale(ajax_todo_info.locale),t("#ajtodo_hello_title").text(ajax_todo_info.hello_title),t("#ajtodo_hello_msg").html(ajax_todo_info.hello_msg),t("#ajtodo_alert_close_big").click(function(){t(".ajtodo_hello").slideUp(1e3,function(){t(this).remove()});var o="action=ajtodo_todo_ajax";o+="&nonce="+ajax_todo_info.nonce,o+="&type=setcookie",o+="&key=hidehello",_(o+="&val=Y","post",function(t){},function(t){})})});